=== Docker build Dockerfile.github
[2018-03-13 14:39.14] Starting...
Cloning into '/tmp/with_clone1fe556c3'...
done.
warning: remote HEAD refers to nonexistent ref, unable to checkout.

HEAD is now at 74494b3 Merge pull request #624 from Thegaram/master
Sending build context to Docker daemon 557.1 kBSending build context to Docker daemon 1.114 MBSending build context to Docker daemon 1.671 MBSending build context to Docker daemon 2.228 MBSending build context to Docker daemon 2.785 MBSending build context to Docker daemon 3.342 MBSending build context to Docker daemon 3.899 MBSending build context to Docker daemon 4.456 MBSending build context to Docker daemon 5.014 MBSending build context to Docker daemon 5.571 MBSending build context to Docker daemon 6.128 MBSending build context to Docker daemon 6.685 MBSending build context to Docker daemon 7.242 MBSending build context to Docker daemon 7.799 MBSending build context to Docker daemon 8.356 MBSending build context to Docker daemon 8.913 MBSending build context to Docker daemon 9.266 MB
Step 1/22 : FROM ocaml/opam-dev:alpine-3.5_ocaml-4.05.0
alpine-3.5_ocaml-4.05.0: Pulling from ocaml/opam-dev
Digest: sha256:56eabc77608dac440c0907a0d3d3c2fbff0d65141b20dc5296783c21d42310d3
Status: Image is up to date for ocaml/opam-dev:alpine-3.5_ocaml-4.05.0
 ---> 1b9232af4c8c
Step 2/22 : RUN sudo apk add --no-cache tzdata aspcud gmp-dev perl libev-dev m4
 ---> Using cache
 ---> eba71ad425f4
Step 3/22 : ENV OPAMERRLOGLEN 0 OPAMYES 1
 ---> Using cache
 ---> 59db52b72500
Step 4/22 : RUN git -C /home/opam/opam-repository fetch origin &&     git -C /home/opam/opam-repository reset 68b69980 --hard &&     opam update -u
 ---> Using cache
 ---> 18ec7a2ddd7b
Step 5/22 : RUN opam install alcotest lwt conf-libev inotify
 ---> Using cache
 ---> 20e2f661466b
Step 6/22 : COPY check-libev.ml /tmp/check-libev.ml
 ---> Using cache
 ---> 711a76860d17
Step 7/22 : RUN opam config exec -- ocaml /tmp/check-libev.ml
 ---> Using cache
 ---> 54a1263fe9b2
Step 8/22 : COPY *.opam /home/opam/src/datakit/
 ---> Using cache
 ---> fe351b34879a
Step 9/22 : RUN opam pin add /home/opam/src/datakit/ -n
 ---> Using cache
 ---> 6d873083a2cb
Step 10/22 : RUN opam install datakit-bridge-github --deps -t
 ---> Using cache
 ---> 61d1423e4118
Step 11/22 : COPY . /home/opam/src/datakit
 ---> 00bd452bff08
Removing intermediate container 2084eeec7d78
Step 12/22 : RUN sudo chown opam.nogroup -R /home/opam/src/datakit
 ---> Running in 90d3b57c996f
 ---> 4b6cde2e01f6
Removing intermediate container 90d3b57c996f
Step 13/22 : RUN opam update --dev && opam upgrade
 ---> Running in c944d0e83618

=-=- Synchronising development packages -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[datakit.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit-bridge-github.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit-bridge-local-git.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit-ci.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit-client.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit-client-9p.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit-client-git.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit-github.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit-server.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit-server-9p.0.12.0] synchronised from file:///home/opam/src/datakit
[datakit] Installing new package description from upstream file:///home/opam/src/datakit
[datakit-bridge-github] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-bridge-github (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-bridge-github.bak
[datakit-bridge-local-git] Installing new package description from upstream file:///home/opam/src/datakit
[datakit-ci] Conflicting update of the metadata from file:///home/opam/src/datakit.
Override files in /home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/overlay/datakit-ci (there will be a backup) ? [Y/n] y
User metadata backed up in /home/opam/.opam/backup/datakit-ci.bak
[datakit-client] Installing new package description from upstream file:///home/opam/src/datakit
[datakit-client-9p] Installing new package description from upstream file:///home/opam/src/datakit
[datakit-client-git] Installing new package description from upstream file:///home/opam/src/datakit
[datakit-github] Installing new package description from upstream file:///home/opam/src/datakit
[datakit-server] Installing new package description from upstream file:///home/opam/src/datakit
[datakit-server-9p] Installing new package description from upstream file:///home/opam/src/datakit
Now run 'opam upgrade' to apply any package updates.
The following actions will be performed:
  - recompile datakit-server     0.12.0* [upstream changes]
  - recompile datakit-client     0.12.0* [upstream changes]
  - recompile datakit-server-9p  0.12.0* [upstream changes]
  - recompile datakit-client-git 0.12.0* [upstream changes]
  - recompile datakit-client-9p  0.12.0* [upstream changes]
  - recompile datakit            0.12.0* [upstream changes]
  - recompile datakit-github     0.12.0* [upstream changes]
===== 7 to recompile =====

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-> removed   datakit-github.0.12.0
-> removed   datakit-client-9p.0.12.0
-> removed   datakit-client-git.0.12.0
-> removed   datakit-client.0.12.0
-> removed   datakit.0.12.0
-> removed   datakit-server-9p.0.12.0
-> removed   datakit-server.0.12.0
-> installed datakit-client.0.12.0
-> installed datakit-client-9p.0.12.0
-> installed datakit-client-git.0.12.0
-> installed datakit-github.0.12.0
-> installed datakit-server.0.12.0
-> installed datakit-server-9p.0.12.0
-> installed datakit.0.12.0
Done.
# Run eval $(opam env) to update the current shell environment
 ---> 233c5fcc4038
Removing intermediate container c944d0e83618
Step 14/22 : RUN opam install datakit-bridge-github -ytv
 ---> Running in ba7c2e28a75e

=-=- Synchronising pinned packages =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/1: [datakit-bridge-github.0.12.0: rsync]
[datakit-bridge-github.0.12.0] no changes from file:///home/opam/src/datakit

The following actions will be performed:
  - install datakit-bridge-github 0.12.0* 

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Processing  1/2: [datakit-bridge-github: jbuilder build]
+ /home/opam/.opam/ocaml-base-compiler.4.05.0/bin/jbuilder "build" "-p" "datakit-bridge-github" "-j" "1" (CWD=/home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/build/datakit-bridge-github.0.12.0)
-     ocamldep bridge/github/main.depends.ocamldep-output
-     ocamldep bridge/github/datakit_bridge_github.depends.ocamldep-output
-     ocamldep bridge/github/datakit_bridge_github.dependsi.ocamldep-output
-     ocamldep src/datakit-log/datakit_log.dependsi.ocamldep-output
-     ocamldep src/datakit-log/datakit_log.depends.ocamldep-output
-     ocamldep bridge/github/main.dependsi.ocamldep-output
-       ocamlc bridge/github/datakit_github_api.{cmi,cmti}
-       ocamlc bridge/github/datakit_github_state.{cmi,cmti}
-       ocamlc bridge/github/datakit_github_sync.{cmi,cmti}
-       ocamlc src/datakit-log/datakit_log.{cmi,cmti}
-     ocamlopt bridge/github/datakit_github_api.{cmx,o}
-     ocamlopt bridge/github/datakit_github_state.{cmx,o}
-       ocamlc bridge/github/version.{cmi,cmo,cmt}
-       ocamlc bridge/github/main.{cmi,cmti}
-     ocamlopt src/datakit-log/datakit_log.{cmx,o}
-     ocamlopt bridge/github/datakit_github_sync.{cmx,o}
-     ocamlopt src/datakit-log/datakit_log.{a,cmxa}
-     ocamlopt bridge/github/version.{cmx,o}
-     ocamlopt bridge/github/datakit_bridge_github.{a,cmxa}
-     ocamlopt bridge/github/main.{cmx,o}
-     ocamlopt bridge/github/main.exe
Processing  1/2: [datakit-bridge-github: jbuilder runtest]
+ /home/opam/.opam/ocaml-base-compiler.4.05.0/bin/jbuilder "runtest" "tests/datakit-bridge-github" (CWD=/home/opam/.opam/ocaml-base-compiler.4.05.0/.opam-switch/build/datakit-bridge-github.0.12.0)
-     ocamldep tests/datakit-bridge-github/test.depends.ocamldep-output
-     ocamldep api/ocaml/datakit_client.depends.ocamldep-output
-     ocamldep api/ocaml/datakit_client.dependsi.ocamldep-output
-     ocamldep src/datakit-github/datakit_github.dependsi.ocamldep-output
-     ocamldep api/ocaml/9p/datakit_client_9p.depends.ocamldep-output
-     ocamldep src/datakit-io/datakit_io.depends.ocamldep-output
-     ocamldep src/datakit-github/datakit_github.depends.ocamldep-output
-     ocamldep src/datakit-server-9p/datakit_server_9p.depends.ocamldep-output
-     ocamldep src/datakit-server/datakit_server.depends.ocamldep-output
-     ocamldep api/ocaml/9p/datakit_client_9p.dependsi.ocamldep-output
-     ocamldep tests/common/test.depends.ocamldep-output
-     ocamldep src/datakit/datakit.depends.ocamldep-output
-     ocamldep src/datakit-io/datakit_io.dependsi.ocamldep-output
-     ocamldep src/datakit-server-9p/datakit_server_9p.dependsi.ocamldep-output
-     ocamldep src/datakit-server/datakit_server.dependsi.ocamldep-output
-     ocamldep src/datakit/datakit.dependsi.ocamldep-output
-       ocamlc src/datakit/datakit__.{cmi,cmo,cmt}
-     ocamldep tests/common/test.dependsi.ocamldep-output
-     ocamldep tests/datakit-bridge-github/test.dependsi.ocamldep-output
-       ocamlc api/ocaml/datakit_client.{cmi,cmti}
-       ocamlc src/datakit-io/datakit_io.{cmi,cmti}
-     ocamlopt src/datakit/datakit__.{cmx,o}
-       ocamlc src/datakit-server/vfs.{cmi,cmti}
-       ocamlc api/ocaml/9p/datakit_client_9p.{cmi,cmti}
-       ocamlc tests/common/test_client.{cmi,cmti}
-       ocamlc src/datakit-github/datakit_github.{cmi,cmti}
-     ocamlopt api/ocaml/datakit_client.{cmx,o}
-       ocamlc src/datakit-server-9p/fs9p.{cmi,cmti}
-       ocamlc src/datakit-server-9p/fs9p_error.{cmi,cmti}
-       ocamlc src/datakit/datakit__Blob.{cmi,cmti}
-       ocamlc src/datakit/datakit__Branch.{cmi,cmti}
-       ocamlc tests/common/test_utils.{cmi,cmo,cmt}
-       ocamlc src/datakit/datakit__Metadata.{cmi,cmti}
-       ocamlc src/datakit/datakit__Path.{cmi,cmti}
-     ocamlopt src/datakit-io/datakit_io.{cmx,o}
-       ocamlc src/datakit-github/datakit_github_conv.{cmi,cmti}
-       ocamlc src/datakit/datakit.{cmi,cmti}
-     ocamlopt api/ocaml/datakit_client.{a,cmxa}
-     ocamlopt src/datakit-server/vfs.{cmx,o}
-       ocamlc src/datakit/datakit__Store.{cmi,cmti}
-     ocamlopt src/datakit-io/datakit_io.{a,cmxa}
-       ocamlc bridge/github/datakit_github_api.{cmi,cmti}
-       ocamlc bridge/github/datakit_github_state.{cmi,cmti}
-       ocamlc bridge/github/datakit_github_sync.{cmi,cmti}
-     ocamlopt tests/common/test_utils.{cmx,o}
-     ocamlopt api/ocaml/9p/datakit_client_9p.{cmx,o}
-     ocamlopt src/datakit-server-9p/fs9p_error.{cmx,o}
-     ocamlopt src/datakit/datakit__Branch.{cmx,o}
-     ocamlopt src/datakit/datakit__Metadata.{cmx,o}
-     ocamlopt src/datakit-server/datakit_server.{a,cmxa}
-     ocamlopt src/datakit/datakit__Blob.{cmx,o}
-     ocamlopt src/datakit/datakit__Path.{cmx,o}
-       ocamlc src/datakit/datakit__Dir.{cmi,cmti}
-       ocamlc src/datakit/datakit__Merge.{cmi,cmti}
-     ocamlopt api/ocaml/9p/datakit_client_9p.{a,cmxa}
-       ocamlc src/datakit/datakit__Remote.{cmi,cmti}
-     ocamlopt src/datakit-github/datakit_github.{cmx,o}
-       ocamlc tests/datakit-bridge-github/test.{cmi,cmti}
-     ocamlopt src/datakit-server-9p/fs9p.{cmx,o}
-     ocamlopt src/datakit-server-9p/datakit_server_9p.{a,cmxa}
-     ocamlopt src/datakit/datakit__Store.{cmx,o}
-     ocamlopt src/datakit/datakit__Dir.{cmx,o}
-     ocamlopt src/datakit/datakit__Merge.{cmx,o}
-     ocamlopt tests/common/test_client.{cmx,o}
-     ocamlopt tests/common/test.{a,cmxa}
-     ocamlopt src/datakit/datakit__Remote.{cmx,o}
-     ocamlopt src/datakit-github/datakit_github_conv.{cmx,o}
-     ocamlopt src/datakit-github/datakit_github.{a,cmxa}
-     ocamlopt bridge/github/datakit_github_state.{cmx,o}
-     ocamlopt bridge/github/datakit_github_api.{cmx,o}
-     ocamlopt bridge/github/datakit_github_sync.{cmx,o}
-     ocamlopt src/datakit/datakit.{cmx,o}
-     ocamlopt src/datakit/datakit.{a,cmxa}
-     ocamlopt tests/datakit-bridge-github/test.{cmx,o}
-     ocamlopt tests/datakit-bridge-github/test.exe
-         test alias tests/datakit-bridge-github/runtest
- /bin/sh: tput: not found
- stty: standard input: Not a tty
- Testing datakit-github.
- [33m ...[m                [36mgithub-9p[m          0   Transaction.[32m[OK][m                [36mgithub-9p[m          0   Transaction.
- [33m ...[m                [36mgithub-9p[m          1   Watch.[32m[OK][m                [36mgithub-9p[m          1   Watch.
- [33m ...[m                [36mgithub-9p[m          2   Make dirs.[32m[OK][m                [36mgithub-9p[m          2   Make dirs.
- [33m ...[m                [36mgithub-9p[m          3   Truncate.[32m[OK][m                [36mgithub-9p[m          3   Truncate.
- [33m ...[m                [36mgithub-9p[m          4   Parents.[32m[OK][m                [36mgithub-9p[m          4   Parents.
- [33m ...[m                [36mgithub-9p[m          5   Merge.[32m[OK][m                [36mgithub-9p[m          5   Merge.
- [33m ...[m                [36mgithub-9p[m          6   Diff.[32m[OK][m                [36mgithub-9p[m          6   Diff.
- [33m ...[m                [36mgithub-9p[m          7   Merge_metadata.[32m[OK][m                [36mgithub-9p[m          7   Merge_metadata.
- [33m ...[m                [36mgithub-9p[m          8   Merge empty.[32m[OK][m                [36mgithub-9p[m          8   Merge empty.
- [33m ...[m                [36mgithub-9p[m          9   Conflicts.[32m[OK][m                [36mgithub-9p[m          9   Conflicts.
- [33m ...[m                [36mgithub-9p[m         10   Large write.[32m[OK][m                [36mgithub-9p[m         10   Large write.
- [33m ...[m                [36mgithub-9p[m         11   Remove.[32m[OK][m                [36mgithub-9p[m         11   Remove.
- [33m ...[m                [36mgithub-9p[m         12   Remotes.[33m[SKIP][m              [36mgithub-9p[m         12   Remotes.
- [33m ...[m                [36mgithub-9p[m         13   Create_or_replace.[33m[SKIP][m              [36mgithub-9p[m         13   Create_or_replace.
- [33m ...[m                [36mgithub[m             0   basic-snapshot.[32m[OK][m                [36mgithub[m             0   basic-snapshot.
- [33m ...[m                [36mgithub[m             1   snapshot.[32m[OK][m                [36mgithub[m             1   snapshot.
- [33m ...[m                [36mgithub[m             2   capabilities.[32m[OK][m                [36mgithub[m             2   capabilities.
- [33m ...[m                [36mgithub[m             3   cleanup.[32m[OK][m                [36mgithub[m             3   cleanup.
- [33m ...[m                [36mgithub[m             4   events.[32m[OK][m                [36mgithub[m             4   events.
- [33m ...[m                [36mgithub[m             5   updates.[32m[OK][m                [36mgithub[m             5   updates.
- [33m ...[m                [36mgithub[m             6   startup.[32m[OK][m                [36mgithub[m             6   startup.
- [33m ...[m                [36mgithub[m             7   random-github.[32m[OK][m                [36mgithub[m             7   random-github.
- [33m ...[m                [36mgithub[m             8   random-github-*.[33m[SKIP][m              [36mgithub[m             8   random-github-*.
- [33m ...[m                [36mgithub[m             9   random-datakit.[32m[OK][m                [36mgithub[m             9   random-datakit.
- [33m ...[m                [36mgithub[m            10   random-datakit-*.[33m[SKIP][m              [36mgithub[m            10   random-datakit-*.
- The full test results are available in `_build/_tests`.
- [32mTest Successful[m in 4.412s. 21 tests run.
-> compiled  datakit-bridge-github.0.12.0
-> installed datakit-bridge-github.0.12.0
Done.
# Run eval $(opam env) to update the current shell environment
 ---> 134b56a8dbb9
Removing intermediate container ba7c2e28a75e
Step 15/22 : RUN sudo cp $(opam config exec -- which datakit-bridge-github) /usr/bin/
 ---> Running in dafc2de792d2
 ---> fa58c76f4cb7
Removing intermediate container dafc2de792d2
Step 16/22 : FROM alpine:3.5
3.5: Pulling from library/alpine
Digest: sha256:9148d069e50eee519ec45e5683e56a1c217b61a52ed90eb77bdce674cc212f1e
Status: Image is up to date for alpine:3.5
 ---> 6c6084ed97e5
Step 17/22 : RUN apk add --no-cache libev gmp tzdata ca-certificates
 ---> Using cache
 ---> 71f3c8d24a78
Step 18/22 : EXPOSE 5640
 ---> Using cache
 ---> 5fa425d68cc9
Step 19/22 : EXPOSE 5641
 ---> Using cache
 ---> 62d5147e39b2
Step 20/22 : ENTRYPOINT /usr/bin/datakit-bridge-github
 ---> Using cache
 ---> df4aebb1f850
Step 21/22 : CMD --listen=tcp://0.0.0.0:5641 -v --datakit=tcp:127.0.0.1:5640
 ---> Using cache
 ---> f5cf83677a6a
Step 22/22 : COPY --from=0 /usr/bin/datakit-bridge-github /usr/bin/datakit-bridge-github
 ---> Using cache
 ---> e7410f588312
Successfully built e7410f588312
[2018-03-13 14:40.40] Success
